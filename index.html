<html>
<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="author" content="Matiboux" />

<link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous" />
<link rel="stylesheet" type="text/css" href="style.css" />
<title>Matiboux › Status</title>

</head>
<body>

<header id="header">
	<div class="title">
		<h1>Matiboux Status</h1>
		<p>Is it down though?™</p>
	</div>
	<div class="timer"><span>>_</span> Loading...</div>
</header>

<div id="main">
	<!--<ul class="settings">
		<li id="toggleDns" class="toggled"><i class="fas fa-globe fa-fw"></i> Domains View</li>
		<li id="toggleHttp"><i class="fas fa-project-diagram fa-fw"></i> Projects View</li>
	</ul>-->
	<article type="dns" src="https://matistat.us/">
		<header>
			<i class="status"></i>
			<span>Domain</span>
			<h2>Matistat.us</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">Status for my projects and.. you're right here! <i class="fas fa-heart fa-fw" style="color: #c04040"></i></p>
		<p class="status-notice">Loading...</p>
	</article>
	<article type="dns" src="https://matiboux.com/">
		<header>
			<i class="status"></i>
			<span>Domain</span>
			<h2>Matiboux.com</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">My personal website. Nothing serious but the projects associated with it.</p>
		<p class="status-notice">Loading...</p>
	</article>
	<article type="dns" src="https://imgshot.eu/">
		<header>
			<i class="status"></i>
			<span>Domain</span>
			<h2>ImgShot.eu</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">Open source and free image hosting service.</p>
		<p class="status-notice">Loading...</p>
	</article>
	<article type="dns" src="https://ljv.fr/">
		<header>
			<i class="status"></i>
			<span>Domain</span>
			<h2>Ljv.fr</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">A high school set of projects.</p>
		<p class="status-notice">Loading...</p>
	</article>
	<article type="dns" src="https://olifw.net/">
		<header>
			<i class="status"></i>
			<span>Domain</span>
			<h2>Olifw.net</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">Website and documentation for Oli, my personal PHP framework.</p>
		<p class="status-notice">Loading...</p>
	</article>
	<article type="dns" src="https://urwebs.it/">
		<header>
			<i class="status"></i>
			<span>Domain</span>
			<h2>Urwebs.it</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">An high school set of projects.</p>
		<p class="status-notice">Loading...</p>
	</article>
</div>

<footer id="footer">
	<section>
		<ul>
			<li><i class="fab fa-github fa-fw"></i> <a href="https://github.com/matiboux/matistat.us">Open-Source Repository</a></li>
			<li><i class="fas fa-globe fa-fw"></i> Check out <a href="https://matiboux.com/">my website</a></li>
		</ul>
	</section>
	<section>Built with love. <i class="fas fa-heart fa-fw" style="color: #c04040"></i></section>
</footer>

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script>
(function() {

/*$('#toggleArchives').click(function() {
	if($(this).hasClass('toggled')) $('#main .projects .item.archive').fadeOut();
	else $('#main .projects .item.archive').fadeIn();
	$(this).toggleClass('toggled');
});
$('#toggleForks').click(function() {
	if($(this).hasClass('toggled')) $('#main .projects .item.fork').fadeOut();
	else $('#main .projects .item.fork').fadeIn();
	$(this).toggleClass('toggled');
});*/

$('#main > article').on('click', 'header > a[href="#"]', function(e) { e.preventDefault(); });

var timer = 0;
var refresh = function() {
	if(timer > 0) {
		timer = timer - 1;
	} else {
		timer = 60;
		
		$('#main > article').each(function() {
			var $this = $(this);
			var url = $this.attr('src');
			$this.find('header > a').attr('href', url)
			
			/*var xhr = new XMLHttpRequest();
			if('withCredentials' in xhr) {
			
				// Check if the XMLHttpRequest object has a "withCredentials" property.
				// "withCredentials" only exists on XMLHTTPRequest2 objects.
				xhr.open('GET', url, true);
			
			} else if (typeof XDomainRequest != 'undefined') {
			
				// Otherwise, check if XDomainRequest.
				// XDomainRequest only exists in IE, and is IE's way of making CORS requests.
				xhr = new XDomainRequest();
				xhr.open('GET', url);
			
			} else {
			
				// Otherwise, CORS is not supported by the browser.
				xhr = null;
			
			}
			
			if (!xhr) throw new Error('CORS not supported');
			else {*/
				$this.find('.status').removeClass().addClass('status status-warning');
				$this.find('.status-notice').html('Checking status..');
				
				/*(function(url, callback) {
					var timer = setTimeout(function() {
						callback(false); // timeout after 5 seconds
					}, 5000);
					
					var img = document.createElement('img');
					img.onload = function() {
						clearTimeout(timer);
						callback(true);
					}
					img.onerror = function() {
						clearTimeout(timer);
						callback(false);
					}
					img.src = url + '/favicon.ico';
				})(url, function(loaded) {
					if(loaded) {
						$this.find('.status').removeClass().addClass('status status-success');
						$this.find('.status-notice').html('Service seems OK!');
					} else {
						$this.find('.status').removeClass().addClass('status status-danger');
						$this.find('.status-notice').html('Service seems down :/');
					}
				});*/
				
				/*xhr.withCredentials = true;
				xhr.overrideMimeType('text/plain');
				xhr.onreadystatechange = function() {
					if(xhr.readyState == 4) {
						if(xhr.status == 200) {
							$this.find('.status').removeClass().addClass('status status-success');
							$this.find('.status-notice').html('Service seems OK!');
						} else {
							$this.find('.status').removeClass().addClass('status status-danger');
							$this.find('.status-notice').html('Service seems down :/');
						}
						console.log("Status: " + xhr.status);
						console.log("Status Text: " + xhr.statusText);
					}
					console.log(url, '...', xhr.readyState, '/', xhr.status, xhr.statusText);
				};
				xhr.send(null);*/
				
				/*(function checkServer(url, timeout) {
					const controller = new AbortController();
					const signal = controller.signal;
					const options = { mode: 'no-cors', signal };
					return fetch(url, options)
						.then(setTimeout(() => { controller.abort() }, timeout))
						.then(response => console.log('Check server response:', response.statusText))
						.catch(error => console.error('Check server error:', error.message));
				})(url, 5000);*/
				
				/*$.ajaxSetup({,
					error: function(xhr, exception) {
						if( xhr.status === 0)
							alert('Error : ' + xhr.status + 'You are not connected.');
						else if( xhr.status == "201")
							alert('Error : ' + xhr.status + '\nServer error.');
						else if( xhr.status == "404")
							alert('Error : ' + xhr.status + '\nPage note found');
						else if( xhr.status == "500")
							 alert('Internal Server Error [500].');
						else if (exception === 'parsererror') 
							alert('Error : ' + xhr.status + '\nImpossible to parse result.');
						else if (exception === 'timeout')
							alert('Error : ' + xhr.status + '\nRequest timeout.');
						else
							alert('Error .\n' + xhr.responseText);
					}
				});*/
				
				$.ajax({
					url: url,
					type: 'GET',
					dataType: 'jsonp'
				}).then(function(data, textStatus, xhr) {
					console.log('DONE', url, '/', data, '...', textStatus, '...', xhr);
					
					/** Everything is fine. */
					$this.find('.status').removeClass().addClass('status status-primary');
					$this.find('.status-notice').html('Service is fine! (Status ' + xhr.status + ')');
				}, function(xhr, textStatus, errorThrown) {
					//console.log('FAIL', url, ':', xhr, textStatus, errorThrown);
					console.log('FAIL', url, ':', xhr, textStatus);
					
					/** XHR query interrupted */
					if(xhr.status === 0) {
						$this.find('.status').removeClass().addClass('status status-danger');
						$this.find('.status-notice').html('Request Interrupted. (Status ' + xhr.status + ')');
					
					/** Service Online */
					} else if(xhr.status == 200) {
						$this.find('.status').removeClass().addClass('status status-success');
						$this.find('.status-notice').html('Service seems OK! (Status ' + xhr.status + ')');
					
					/** 201 Created */
					} else if(xhr.status == 201) {
						$this.find('.status').removeClass().addClass('status status-warning'); 
						$this.find('.status-notice').html('Server error. (Status ' + xhr.status + ')');
					
					/** 404 Not Found */
					} else if(xhr.status == 404) {
						$this.find('.status').removeClass().addClass('status status-warning'); 
						$this.find('.status-notice').html('Page not found. (Status ' + xhr.status + ')');
					
					/** 500 Internal server error */
					} else if(xhr.status == 500) {
						$this.find('.status').removeClass().addClass('status status-danger'); 
						$this.find('.status-notice').html('Internal server error. (Status ' + xhr.status + ')');
					
					} else {
						$this.find('.status').removeClass().addClass('status status-danger');
						$this.find('.status-notice').html('Error! (Status ' + xhr.status + ')');
					}
					
					if(exception === 'parsererror') console.log(url, 'Impossible to parse result.');
					else if(exception === 'timeout') console.log(url, 'Request timeout.');
					else console.log(url, 'Error!');
					
					$this.find('.status').removeClass().addClass('status status-danger');
					$this.find('.status-notice').html('Service seems down :/');
				})/*.done(function(response) {
					$this.find('.status').removeClass().addClass('status status-success');
					$this.find('.status-notice').html('Service seems OK!');
				}).fail(function() {
					$this.find('.status').removeClass().addClass('status status-danger');
					$this.find('.status-notice').html('Service seems down :/');
				})*/;
			//}
			
		});
	}
	
	$('#header .timer').empty().append(
		'Refreshing in', $('<br>'),
		$('<span>').html(timer), ' seconds..'
	);
	setTimeout(refresh, 1000);
}
refresh(); // Start

})();

</script>

</body>
</html>